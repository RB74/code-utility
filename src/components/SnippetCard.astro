---
import prefabs from 'prefabs/index.js';

import Image from 'components/Image.astro';

const { snippet } = Astro.props;

const hasCodeBlocks = Boolean(snippet.codeBlocks && snippet.codeBlocks.length);
const hasScopeCSS = Boolean(snippet.code && snippet.code.scopedCss);
---

<article class={prefabs.snippetCard}>
  <h1 class={prefabs.cardTitle}>{snippet.title}</h1>
  <p class={prefabs.cardSubtitle}>
    {snippet.tags} &middot; <span class='inline-block'>{snippet.date}</span>
  </p>
  <Image
    class='ar-wide mt-5 br-md'
    src={snippet.cover}
    alt=''
    height='180'
    width='360'
    fetchpriority='high'
  />
  <div
    class='card-description flex flex-col'
    set:html={snippet.fullDescription}
  />
  {
    hasScopeCSS && (
      <div class='card-preview-content br-md pt-4'>
        <h5 class='txt-150 fs-md f-strong lh-tight my-0 mr-0 ml-3.5'>Preview</h5>
        <div class='py-3 px-3.5 m-0' data-scope='snippet-preview'>
          <style set:html={snippet.code.scopedCss} />
          <div set:html={snippet.code.html} />
        </div>
      </div>
    )
  }
  {
    hasCodeBlocks && (
      <div class='card-source-content m-0'>
        {snippet.codeBlocks.map(({ language, htmlContent }) => (
          <div class='code-highlight relative'>
            <pre
              data-code-language={language.long}
              class={`notranslate m-0 language-${language.short}`}
              translate="no"
              set:html={htmlContent}
            />
            <button
              class={prefabs.copyCodeButton}
              title='Copy code'
            />
          </div>
        ))}
      </div>
    )
  }
  {
    snippet.author ? (
      <div class='flex flex-col m-0'>
        <h3 class='mt-4 mb-0 mx-0 txt-150 fs-md md:fs-lg lh-tight'>
          Written by {snippet.author.name}
        </h3>
        <p class='lh-loose mx-0 mt-2 mb-0 txt-100 fs-sm md:fs-md'>
          {snippet.author.intro}
        </p>
        <p class='lh-loose m-0 txt-100 fs-sm md:fs-md'>
          {'If you want to keep in touch, follow me on '}
          <a
            href={snippet.author.github}
            target='_blank'
            rel='nofollow noopener noreferrer'
          >
            GitHub
          </a>
          {' or '}
          <a
            href={snippet.author.twitter}
            target='_blank'
            rel='nofollow noopener noreferrer'
          >
            Twitter<!-- --></a><!-- -->.
        </p>
      </div>
    ) : null
  }
  <div class='card-actions flex j-space-evenly mt-4 mx-0 mb-0'>
    {
      snippet.actionType === 'codepen' && (
        <button
          class={`${prefabs.button} ${prefabs.actionButton} ${prefabs.iconButton} flex-none before:fs-md icon-codepen my-0 mx-2 p-3`}
          title='View CodePen'
        />
      )
    }
    <a
      class={`${prefabs.button} ${prefabs.actionButton} ${prefabs.iconButton} flex-none before:fs-md icon-github my-0 mx-2 p-3`}
      href={snippet.url}
      rel='nofollow noopener noreferrer'
      target='_blank'
      title='View on GitHub'></a>
  </div>
</article>
